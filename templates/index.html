<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My To-Do List App</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js" type="module"></script>
</head>
<body>
  <h1>Welcome to My To-Do List App!</h1>

  <form method="POST" action="{{ url_for('complete_tasks') }}">
    <ul>
      {% for task in tasks %}
      <li>
        <input type="checkbox" name="taskCheckbox" value="{{ task[0] }}" {% if task[3] %}checked disabled{% endif %}>
        <span style="{% if task[3] %}text-decoration: line-through;{% endif %}">{{ task[2] }}</span>
        <button type="button" onclick="deleteTask({{ task[0] }})">‚ùå</button>
      </li>
      {% endfor %}
    </ul>
    <input type="hidden" name="uid" id="uid-field">
    <button type="submit">Mark Completed</button>
  </form>

  <form method="POST" action="{{ url_for('add_task') }}">
    <label for="newTask">Add Task:</label>
    <input type="text" name="newTask" placeholder="New task" required>
    <input type="hidden" name="uid" id="uid-add">
    <button type="submit">Add Task</button>
  </form>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAAk-bactk5tD6TSnR0uMF8FKevvUOEaFY",
      authDomain: "todolistapp-666b6.firebaseapp.com",
      projectId: "todolistapp-666b6",
      storageBucket: "todolistapp-666b6.firebasestorage.app",
      messagingSenderId: "928757322075",
      appId: "1:928757322075:web:026a06b4c0b19d026b8a7e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    onAuthStateChanged(auth, user => {
      if (user) {
        document.getElementById('uid-field').value = user.uid;
        document.getElementById('uid-add').value = user.uid;
      } else {
        alert("You are not logged in!");
        window.location.href = "login.html";
      }
    });

    window.deleteTask = function (taskId) {
      if (confirm('Are you sure you want to delete this task?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = "{{ url_for('delete_task') }}";

        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'task_id';
        input.value = taskId;

        const uid = document.getElementById('uid-field').value;
        const uidInput = document.createElement('input');
        uidInput.type = 'hidden';
        uidInput.name = 'uid';
        uidInput.value = uid;

        form.appendChild(input);
        form.appendChild(uidInput);
        document.body.appendChild(form);
        form.submit();
      }
    }
  </script>
</body>
</html>